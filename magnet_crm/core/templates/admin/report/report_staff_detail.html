
{% extends 'base/head.html' %}
{% load core_extras %}
{% block content %}

<style type="text/css">
	#table_followup tr{
		height: 80px
	}

	#table_schedule tr{
		height: 80px
	}
	.gadget_green{
        white-space: nowrap;background-color: #e8f5eb;border-radius: 10px;position: relative;   
    }
</style>
<div class="row">
	<!-- Typeahead -->
	<div class="card col-12">
		
	<div class="card-header">
		<h5 class="card-title">Client Detail & Info</h5>
	</div>

	<div class="card-body">
		<div class="row">
			<dir class="col" >
				Staff : {{staff}}<br>
				Position : {{staff.staff_level.level_name}}
			</dir>
			<dir class="col text-right" >
				<a class="btn btn-success" id="download-btn">Export</a>
			</dir>
		</div>	
		<form method="POST" id="export_form">
			{% csrf_token %}
			<input hidden id="download_param" name="download_excel" value="0"> 
		</form>

		<div class="row">
			<div class="col">
                <h5 class="p-0 m-0">Start date</h5>
                <div class='input-group date datepicker' id='date-pick-from' onchange="change_filter()">
                  <input type='text' name="tgl" id="date-from-val" class="form-control" value="{{request.GET.date}}" />
                  <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                  </span>
                </div>
            </div>
		</div>	
		{% if client_position_list|length > 0 or client.is_deposit %}
		<div class="row">
			<dir class="col-12" style="text-align: right;">
				<a href="{% url 'client-position-history' client.id %}">
					<button class="btn green-btn">Client History</button>
				</a>
				<!-- <a href="{% url 'client-position' client.id %}">
					<button class="btn green-btn">Client Position</button>
				</a> -->
			</dir>
		</div>	
		{% endif %}
		<div class="row">

			{% if staff.staff_level.level_name == "Financial Consultant" %}
			<div class="col-12">
				<div class="row mb-3" style="line-height: 1">
                        <div class="col py-2 px-3 " >
                            <div style="display: inline-block;" class="mr-3 gadget_green p-3">
                                <h1 class="p-0 m-0" style="color:green;font-size: 2.5em;line-height:1">{{total_client|default:"-"}}</h1>
                                <p class="mb-0">Total Client</p>
                            </div>
                            <div style="display: inline-block;" class="mr-3 gadget_green p-3">
                                <h1 class="p-0 m-0" style="color:green;font-size: 2.5em;line-height:1">{{total_amount|num_format|default:"-"}}</h1>
                                <p class="mb-0">Total Amount FTD</p>
                            </div>
                            <div style="display: inline-block;" class="mr-3 gadget_green p-3">
                                <h1 class="p-0 m-0" style="color:green;font-size: 2.5em;line-height:1">{{bonus_per_ft|num_format|default:"-"}}</h1>
                                <p class="mb-0">Bonus Per Ft</p>
                            </div>
                        </div>
                    </div>
			</div >

			<div class="col-12 ">
				<h5>Client Position</h5>
					<div class="card p-2" style="">

						<table class="table" id="table_position" style="max-height: 100vh">
						  <thead>
	                            <tr>
	                                <th scope="col">#</th>
	                                <th scope="col">Name</th>
	                                <th scope="col">userid</th>
	                                <th scope="col">login</th>
	                                <th scope="col">ftd</th>
	                                <th scope="col">time</th>
	                            </tr>
	                        </thead>
						  <tbody>
                            {% for x in all_so %}
	                            
	                                <tr>
	                                    <th scope="row">{{forloop.counter}}</th>
	                                    <th scope="row">{{client_dict|dict_get:x.userid}}</th>
	                                    <th scope="row">{{x.userid}}</th>
	                                    <td>
	                                       {{x.login}}
	                                    </td>
	                                    <td>
	                                        {{x.ftd}}
	                                    </td>
	                                    <td>
	                                        {{x.time}}
	                                    </td>
	                                </tr>
	                        {% endfor %}
                        
                            </tbody>
						</table>
					</div>
			</div>
			{% endif %}

			{% if staff.staff_level.level_name != "IB" %}
			<div class="col-12">
				<div class="row mb-3" style="line-height: 1">
                        <div class="col py-2 px-3 " >
                            <div style="display: inline-block;" class="mr-3 gadget_green p-3">
                                <h1 class="p-0 m-0" style="color:green;font-size: 2.5em;line-height:1">{{total_bonus|num_format|default:"-"}}</h1>
                                <p class="mb-0">Total Bonus</p>
                            </div>
                    </div>
			</div>
			<div class="col-12 ">
				<h5>Bonus</h5>
					<div class="card p-2" style="">

						<table class="table" id="table_bonus" style="max-height: 100vh">
						  <thead>
	                            <tr>
	                                <th scope="col">#</th>
	                                <th scope="col">Name</th>
	                                <th scope="col">Login</th>
	                                <th scope="col">Account Type</th>
	                                <!-- <th scope="col">Bonus</th> -->
	                                <th scope="col">Lot</th>
	                            </tr>
	                        </thead>
						  <tbody>
                            {% for x in display_bonus_dict %}
	                            
	                                <tr>
	                                    <th scope="row">{{forloop.counter}}</th>
	                                    {% with x|stringformat:"s" as x_str %}
	                                    	{% with client_user_id_login_dict|dict_get:x_str as x_mag_id %} 
	                                    	<th scope="row">{{client_dict|dict_get:x_mag_id}}</th>
	                                    	<th scope="row">{{x}}</th>
	                                    	
		                                    <td >{{display_bonus_dict|dict_get:x_str|dict_get:'account_type' }}</td>
		                                    
		                                    <td>
		                                        {{display_bonus_dict|dict_get:x_str|dict_get:'lot' }}
		                                    </td>
		                                    {% endwith %}
	                                    {% endwith %}
	                                </tr>
	                        {% endfor %}
                        
                            </tbody>
						</table>
					</div>
			</div>
			{% endif %}

			
			<!-- <div class="col-12">
				<div class="row mb-3" style="line-height: 1">
                        <div class="col py-2 px-3 " >
                            <div style="display: inline-block;" class="mr-3 gadget_green p-3">
                                <h1 class="p-0 m-0" style="color:green;font-size: 2.5em;line-height:1">{{total_bonus_3|num_format|default:"-"}}</h1>
                                <p class="mb-0">Total Bonus</p>
                            </div>
                    </div>
			</div>
			<div class="col-12 ">
				<h5>Skema IB</h5>

					<div class="card p-2" style="">

						<table class="table" id="table_bonus_2" style="max-height: 100vh">
						  <thead>
	                            <tr>
	                                <th scope="col">#</th>
	                                <th scope="col">Name</th>
	                                <th scope="col">Login</th>
	                                <th scope="col">Account Type</th>
	                            </tr>
	                        </thead>
						  <tbody>
                            {% for x in display_bonus_3_dict %}
	                            	
	                                <tr>
	                                    <th scope="row">{{forloop.counter}}</th>
	                                    
	                                    {% with x|stringformat:"s" as x_str %}
	                                    	{% with client_user_id_login_dict|dict_get:x_str as x_mag_id %} 
	                                    	<td >{{client_dict|dict_get:x_mag_id}}</td>
	                                    	<td >{{x}}</td>
	                                    	<td >{{display_bonus_dict|dict_get:x_str|dict_get:'account_type' }}</td>
	                                    	{% endwith %}
	                                    {% endwith %}
	                                </tr>
	                        {% endfor %}
                        
                            </tbody>
						</table>
					</div>
			</div>
			 -->
			
			

			

		</div>

	</div>
	<!-- /typeahead -->
</div>
<script type="text/javascript">
	function change_filter(){
        from = $("#date-from-val").val()
        window.location = "{% url 'staff-report-detail' staff.uid %}"+"?date="+from

    }

    $("#download-btn").click(function() {
			console.log("masuk ke download button")

			
			
		
			{% if staff.staff_level.level_name == "Financial Consultant" %}
				// console.log("masuk 1")
				// $("#download_param").val("1");
		  //   	$("#export_form").attr("method", "post");
				// $("#export_form").submit()
				// $("#download_param").val("0");
				// popupWindow1 = window.open('{% url "staff-report-detail" staff.uid %}?download_excel=1');

			{% endif %}
			{% if staff.staff_level.level_name != "IB" %}
				// popupWindow2 = window.open('{% url "staff-report-detail" staff.uid %}?download_excel=2');
			{% endif %}
				// popupWindow3 = window.open('{% url "staff-report-detail" staff.uid %}?download_excel=3');

				popupWindow3 = window.open('{% url "staff-report-detail" staff.uid %}?download_excel=combination');				
		})


	$("#date-pick-from").datepicker( {
		    format: "mm-yyyy",
		    startView: "months", 
		    minViewMode: "months"
		});

	$("#table_position").DataTable({
		dom: '<"datatable-header"fl><"datatable-scroll datatable-scroll-wrap"t><"datatable-footer"ip>',
		language: {
            search: '<span>Filter:</span> _INPUT_',
            searchPlaceholder: 'Type to filter...',
            lengthMenu: '<span>Show:</span> _MENU_',
        },
        scrollX: true,
        // scrollY: '350px',
        scrollCollapse: true,
        fixedColumns: {
            leftColumns: 2,
            // rightColumns: 1
        }
    });

    $("#table_bonus").DataTable({
		dom: '<"datatable-header"fl><"datatable-scroll datatable-scroll-wrap"t><"datatable-footer"ip>',
		language: {
            search: '<span>Filter:</span> _INPUT_',
            searchPlaceholder: 'Type to filter...',
            lengthMenu: '<span>Show:</span> _MENU_',
        },
        scrollX: true,
        // scrollY: '350px',
        scrollCollapse: true,
        fixedColumns: {
            leftColumns: 2,
            // rightColumns: 1
        }
    });

    $("#table_bonus_2").DataTable({
		dom: '<"datatable-header"fl><"datatable-scroll datatable-scroll-wrap"t><"datatable-footer"ip>',
		language: {
            search: '<span>Filter:</span> _INPUT_',
            searchPlaceholder: 'Type to filter...',
            lengthMenu: '<span>Show:</span> _MENU_',
        },
        scrollX: true,
        // scrollY: '350px',
        scrollCollapse: true,
        fixedColumns: {
            leftColumns: 2,
            // rightColumns: 1
        }
    });
</script>
{% endblock content %}