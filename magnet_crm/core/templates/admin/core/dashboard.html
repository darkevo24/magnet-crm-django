
{% extends 'base/head.html' %}
{% block content %}
{% load static %}
{% load core_extras %}
<script src="{% static 'limitless/global_assets/js/plugins/ui/fullcalendar/main.min.js' %}"></script>
<div class="row">
	<!-- Typeahead -->
	<div class="card col-12">
		<div class="card-header">
			<h5 class="card-title">Dashboard</h5>
		</div>

		<div class="card-body">
            <div class="row">
                <div class="col-3">
                    <div class="row" style="line-height: 1">
                        
                        <div class="col" style="white-space: nowrap;">
                            <div style="display: inline-block;">
                                <h1 style="color:green;font-size: 2.5em;">{{total_client}}</h1>    
                            </div>
                            
                            <div style="display: inline-block;">
                                <p class="mb-0"><b>Total Client</b></p>
                                <p class="mb-0" style="font-size: 0.8em;color:silver">&nbsp;</p>    
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div class="row" style="line-height: 1">
                        
                        <div class="col" style="white-space: nowrap;">
                            <div style="display: inline-block;">
                                <h1 style="color:green;font-size: 2.5em;">{{total_followup}}</h1>    
                            </div>
                            
                            <div style="display: inline-block;">
                                <p class="mb-0"><b>Total Followup</b></p>
                                <p class="mb-0" style="font-size: 0.8em;color:silver">&nbsp;</p>    
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div class="row" style="line-height: 1">
                        
                        <div class="col" style="white-space: nowrap;">
                            <div style="display: inline-block;">
                                <h1 style="color:green;font-size: 2.5em;">{{total_feedback}}</h1>    
                            </div>
                            
                            <div style="display: inline-block;">
                                <p class="mb-0"><b>Total Feedback</b></p>
                                <p class="mb-0" style="font-size: 0.8em;color:silver">&nbsp;</p>    
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div class="row" style="line-height: 1">
                        
                        <div class="col" style="white-space: nowrap;">
                            <div style="display: inline-block;">
                                <h1 style="color:red;font-size: 2.5em;">{{total_upcomming_followup}}</h1>    
                            </div>
                            
                            <div style="display: inline-block;">
                                <p class="mb-0"><b>Upcomming Followup</b></p>
                                <p class="mb-0" style="font-size: 0.8em;color:silver">&nbsp;</p>    
                            </div>
                        </div>
                    </div>
                </div>
            </div>

			<div class="row">
				<div class="col-12">
					<ul class="nav nav-tabs nav-tabs-highlight">
                                <!-- <li class="nav-item"><a href="#highlighted-justified-tab1" class="nav-link active" data-toggle="tab">General Information</a></li> -->

                                <li class="nav-item"><a href="#highlighted-justified-tab2" class="nav-link active" data-toggle="tab">Clients</a></li>
                                <li id="calendar-tab" class="nav-item"><a href="#highlighted-justified-tab3" class="nav-link" data-toggle="tab">Callendar</a></li>
                                <!-- <li class="nav-item dropdown">
                                    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Calendars</a>
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <a href="#highlighted-justified-tab3" class="dropdown-item" data-toggle="tab">Dropdown tab</a>
                                        <a href="#highlighted-justified-tab4" class="dropdown-item" data-toggle="tab">Another tab</a>
                                    </div>
                                </li> -->
                            </ul>

                            <div class="tab-content">
                                <!-- <div class="tab-pane fade show active" id="highlighted-justified-tab1">
                                    

                                </div> -->

                                <div class="tab-pane fade active show" id="highlighted-justified-tab2">
                                    <ul class="media-list">
                                        
                                            
                                            {% for client in all_client %}

                                                <li class="media">
                                                    <div class="media-body ">
                                                        <div class="media-title font-weight-semibold">{{client.nama}}</div>
                                                        <div class="pl-1 text-muted">{{client.phone_no}}</div>
                                                        <div class="pl-1 text-muted">{{client.email}}</div>

                                                        

                                                    </div>

                                                   <div class="align-self-center ml-3">
                                                        <!-- <i class="fab fa-whatsapp mr-3 whatsapp-button" data-client_id="{{client.id}}" data-journey_type="whatsapp" style="font-size:1.8em"></i> -->
                                                        <img class="list-icons-item clickable whatsapp-button" data-client_id="{{client.id}}"  data-popup="tooltip" title="WA" data-journey_type="whatsapp" src="{% static 'magnet/images/admin-wa.png' %}" style="height:2.4em" >
                                                        
                                                        <!-- <i class="fas fa-phone mr-3 call-button" style="font-size: 1.8em" data-client_id="{{client.id}}" data-journey_type="called">
                                                        </i> -->
                                                        
                                                        <!-- <a class="list-icons-item clickable call-button" data-popup="tooltip" title="Call" data-client_id="{{client.id}}" data-journey_type="called" data-toggle="modal" data-trigger="hover" data-target="#call"><i class="fas fa-phone mr-3" style="font-size: 1.8em"></i></a> -->

                                                        <img class="list-icons-item clickable call-button" data-popup="tooltip" title="Call" data-client_id="{{client.id}}" data-journey_type="called" data-toggle="modal" data-trigger="hover" data-target="#call" src="{% static 'magnet/images/admin-call.png' %}" style="height:2.4em" >


                                                        <!-- <a class="list-icons-item" href="{% url 'client-followup-list' client.id  %}"><i class="far fa-calendar-plus mr-3" style="font-size: 1.8em"></i></a> -->

                                                        <a href="{% url 'client-followup-list' client.id  %}"><img class="list-icons-item"  data-popup="tooltip" title="Feedback" src="{% static 'magnet/images/admin-feedback.png' %}" style="height:2.4em" ></a>


                                                        <div class="list-icons">
                                                            <div class="dropdown">
                                                                <a href="#" class="list-icons-item" data-toggle="dropdown">
                                                                    <i class="icon-menu9" style="font-size: 1.8em"></i>
                                                                </a>

                                                                <div class="dropdown-menu dropdown-menu-right">
                                                                    <a href="{% url 'client-schedule-list' client.id  %}" class="dropdown-item">
                                                                        <i class="fa-calendar-alt"></i> List Schedule
                                                                    </a>
                                                                    <a href="{% url 'client-schedule-add' client.id  %}" class="dropdown-item">
                                                                        <i class="fa-calendar-alt"></i> Add Schedule
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </li>
                                            {% endfor %}

                                        
                                    </ul>
                                </div>

                                <div class="tab-pane" id="highlighted-justified-tab3">
                                    <div class="fullcalendar-basic">
                                    </div>
                                </div>

                                <!-- <div class="tab-pane fade" id="highlighted-justified-tab4">
                                    Aliquip jean shorts ullamco ad vinyl cillum PBR. Homo nostrud organic, assumenda labore aesthet.
                                </div> -->
                            </div>
					
				</div>
			</div>
		</div>
	</div>
	<!-- /typeahead -->
</div>
<!-- Phone call modal -->
                    <div id="call" class="modal fade">
                        <div class="modal-dialog modal-sm">
                            <div class="modal-content">
                                <div class="modal-body text-center">
                                    <div class="card-img-actions d-inline-block mb-3">
                                        <script src="{% static 'limitless/global_assets/js/plugins/forms/inputs/duallistbox/duallistbox.min.js' %}"></script>
                                        <img class="rounded-circle" src="{% static 'limitless/global_assets/images/placeholders/placeholder.jpg' %}" width="160" height="160" alt="">
                                        <div class="card-img-actions-overlay card-img rounded-circle">
                                            <a href="#" class="btn btn-outline-white border-2 btn-icon rounded-pill">
                                                <i class="icon-question7"></i>
                                            </a>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <h6 class="font-weight-semibold mb-0">Nathan Jacobson</h6>
                                        <span class="d-block text-muted">Lead UX designer</span>
                                    </div>

                                    <ul class="list-inline mb-0">
                                        <li class="list-inline-item"><a href="#" class="btn btn-success btn-float rounded-pill"><i class="icon-phone2"></i></a></li>
                                        <li class="list-inline-item"><a href="#" class="btn btn-danger btn-float rounded-pill" data-dismiss="modal"><i class="icon-phone-slash"></i></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /phone call modal -->

<script type="text/javascript">
	$( document ).ready(function() {
    	console.log( "ready!" );

    	
    	events = {{client_schedule_list_json|safe}};
    	const calendarBasicViewElement = document.querySelector('.fullcalendar-basic');

        // Initialize
        
        const calendarBasicViewInit = new FullCalendar.Calendar(calendarBasicViewElement, {
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            initialDate: '2020-09-12',
            navLinks: true, // can click day/week names to navigate views
            nowIndicator: true,
            weekNumberCalculation: 'ISO',
            editable: true,
            selectable: true,
            direction: document.dir == 'rtl' ? 'rtl' : 'ltr',
            dayMaxEvents: true, // allow "more" link when too many events
            events: events
        });

        // Init
        // calendarBasicViewInit.render();

        // Resize calendar when sidebar toggler is clicked
        $('.sidebar-control').on('click', function() {
            calendarBasicViewInit.updateSize();
        });
        var counter = 1;
        $('#calendar-tab').click(function(){
        	console.log(123123);
        	const myTimeout = setTimeout(init_calendar, 1200);
        	// setTimeout("calendarBasicViewInit.render();", 1000);
        	// setTimeout(() => {calendarBasicViewInit.render()}, 1)
        });

        function init_calendar() {
        	calendarBasicViewInit.render();
        }
        $('.call-button').click(function(){
            var client_id = $(this).data('client_id');
            var journey_type = $(this).data('journey_type');
            console.log(client_id, journey_type)
            submit_user_journey(client_id, journey_type)

        });
        $('.whatsapp-button').click(function(){
            var client_id = $(this).data('client_id');
            var journey_type = $(this).data('journey_type');
            console.log(client_id, journey_type)
            submit_user_journey(client_id, journey_type)

        });
        $('.feedback-button').click(function(){
            var client_id = $(this).data('client_id');
            var journey_type = $(this).data('whatsapp');
            console.log(client_id, journey_type)
            submit_user_journey(client_id, journey_type)

        });
        function submit_user_journey(client_id, journey_type)
        {
            var string_url = "{% url 'client-journey-add' 0 'default' %}"
            string_url = string_url.replace('0', client_id)
            string_url = string_url.replace('default', journey_type)
            console.log(string_url)
            $.ajax({
                url: string_url,
                type: 'get',
                // dataType: 'json',
                // data: {
                //     csrfmiddlewaretoken:"{{csrf_token}}",
                //     tree_level: code,
                // },
                error: function() {
                    console.log("error")
                },
                success: function(res) {
                    // print(res)
                    console.log(res)

                }
            });
        }
      

	});

	
</script>
{% endblock content %}

							
						